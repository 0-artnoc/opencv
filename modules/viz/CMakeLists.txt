macro(find_qvtk)
  find_library (QVTK_LIBRARY QVTK HINTS ${VTK_DIR} ${VTK_DIR}/bin)
  find_path (QVTK_INCLUDE_DIR QVTKWidget.h HINT ${VTK_INCLUDE_DIRS})
  find_package_handle_standard_args(QVTK DEFAULT_MSG QVTK_LIBRARY QVTK_INCLUDE_DIR)

  if(QVTK_FOUND)   
    get_filename_component (QVTK_LIBRARY_DIR ${QVTK_LIBRARY} PATH)
    list(APPEND VTK_LIBRARY_DIRS ${QVTK_LIBRARY_DIR})
    list(APPEND VTK_INCLUDE_DIRS ${QVTK_INCLUDE_DIR})
    set (VTK_USE_QVTK ON)
  endif()
endmacro()

macro(find_vtk)
  find_package(VTK 5.10.0 REQUIRED)
  if(VTK_FOUND)
    if (BUILD_SHARED_LIBS OR (NOT BUILD_SHARED_LIBS AND NOT VTK_BUILD_SHARED_LIBS))
      find_qvtk()
      message(STATUS "VTK found (include: ${VTK_INCLUDE_DIRS}, lib: ${VTK_LIBRARY_DIRS})")
      link_directories(${VTK_LIBRARY_DIRS})
      include_directories(SYSTEM ${VTK_INCLUDE_DIRS})
      set(HAVE_VTK ON)    
    else ()
      set(HAVE_VTK OFF)
      message (WARNING "VTK disabled. You are to build OpenCV in STATIC but VTK is SHARED!")
    endif ()
  endif()
endmacro()

find_vtk()

if(HAVE_VTK)
  set(VTK_USE_FILE ${VTK_USE_FILE} CACHE INTERNAL "VTK_USE_FILE")
  include (${VTK_USE_FILE})
  add_definitions(-DHAVE_VTK)
else()
  return()
endif()


set(the_description "Viz")
set(BUILD_opencv_viz_INIT OFF)
include_directories(src)
ocv_define_module(viz opencv_core)

if(BUILD_opencv_viz)
  target_link_libraries(opencv_viz vtkCommon vtkWidgets vtkFiltering vtkRendering)
  if(APPLE)
      target_link_libraries(opencv_viz "-framework Cocoa")
  endif()
endif()
